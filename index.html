<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Bienvenido</title>
    <link rel="stylesheet" href="style/common.css" />
  </head>
  <body>
    <!-- 1. Modal de selección de plataforma -->
    <div id="platform-modal">
      <h2>Selecciona tu plataforma</h2>
      <div class="platform-options">
        <button class="plat-btn" data-platform="desktop" tabindex="1">
          <img src="img/ico-desktop.png" alt="" /><span>Desktop</span>
        </button>
        <button class="plat-btn" data-platform="mobile" tabindex="2">
          <img src="img/ico-mobile.png" alt="" /><span>Smartphone/Tablet</span>
        </button>
        <button class="plat-btn" data-platform="android-tv" tabindex="3">
          <img src="img/ico-tv.png" alt="" /><span>Android TV</span>
        </button>
      </div>
    </div>

    <!-- 2. Loading y animación logo -->
    <div id="loading-screen">
      <div class="logo-load"></div>
    </div>

    <!-- 3. Landing principal -->
    <div id="landing">
      <div class="hero">
        <div class="logo-hero"></div>
        <h1>Tu plataforma de películas</h1>
        <button id="enter-btn" tabindex="4">Ingresar gratis</button>
      </div>
    </div>

    <script src="script/detect.js"></script>
    <script>
      const LOGO_ANIM_DURATION = 1000;

      // 1) Al cargar, comprobamos si ya hay elección
      const saved = localStorage.getItem("platformChoice");
      const modal = document.getElementById("platform-modal");
      const landing = document.getElementById("landing");
      const loader = document.getElementById("loading-screen");
      const enterBtn = document.getElementById("enter-btn");

      function startLanding() {
        // Oculta modal, inicia animación y luego muestra landing
        modal.classList.add("hidden");
        loader.classList.remove("hidden");
        setTimeout(() => {
          loader.classList.add("hidden");
          landing.classList.add("visible");
          document.querySelector(".logo-hero").classList.add("visible");
        }, LOGO_ANIM_DURATION);
      }

      if (saved) {
        // Si ya elegido, ocultar modal y comenzar directamente
        modal.classList.add("hidden");
        window.addEventListener("load", startLanding);
      } else {
        // Mostrar modal, sin landing ni loader
        loader.classList.add("hidden");
        landing.classList.add("hidden");
        // Manejar elección
        document.querySelectorAll(".plat-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            const p = btn.dataset.platform;
            localStorage.setItem("platformChoice", p);
            startLanding();
          });
        });
      }

      // 2) Manejo del botón Ingresar
      enterBtn.addEventListener("click", () => {
        const dev = localStorage.getItem("platformChoice");
        // redirige según la elección
        switch (dev) {
          case "android-tv":
            location.href = "smarttv.html";
            break;
          case "mobile":
            location.href = "android/mobile.html";
            break;
          default:
            location.href = "desktop.html";
        }
      });
      // soporte remoto: con Enter
      enterBtn.addEventListener("keydown", (e) => {
        if (e.key === "Enter") enterBtn.click();
      });
    </script>
  </body>
</html>
