<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Video Player</title>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #000;
      }
      .video-container {
        position: relative;
        width: 100%;
        max-width: 100%;
        height: 100%;
      }
      iframe {
        width: 100%;
        height: 100%;
        border: none;
      }
    </style>
  </head>
  <body>
    <div class="video-container">
      <iframe
        id="videoFrame"
        src="https://betzta.com/canales.php?stream=ds"
        allowfullscreen
      ></iframe>
    </div>

    <script>
      function reloadIframe() {
        const iframe = document.getElementById("videoFrame");
        const src = iframe.src;
        iframe.src = "";
        iframe.src = src;
      }

      function blockPopups() {
        const open = window.open;
        window.open = function () {
          console.log("Popup blocked");
          return null;
        };
        document.addEventListener(
          "click",
          function (event) {
            if (event.target.tagName === "A") {
              event.preventDefault();
              console.log("Link click blocked");
            }
          },
          true
        );
      }

      function monitorIframe() {
        const iframe = document.getElementById("videoFrame");
        const observer = new MutationObserver((mutations) => {
          mutations.forEach((mutation) => {
            if (mutation.addedNodes.length) {
              mutation.addedNodes.forEach((node) => {
                if (node.tagName === "A") {
                  node.addEventListener("click", (event) => {
                    event.preventDefault();
                    console.log("Iframe link click blocked");
                  });
                }
              });
            }
          });
        });

        observer.observe(
          iframe.contentDocument || iframe.contentWindow.document,
          {
            childList: true,
            subtree: true,
          }
        );
      }

      document.addEventListener("DOMContentLoaded", () => {
        blockPopups();

        const iframe = document.getElementById("videoFrame");

        iframe.addEventListener("load", function () {
          monitorIframe();
          console.log("Iframe loaded and monitoring for popups");
        });

        setInterval(() => {
          const iframeDoc =
            iframe.contentDocument || iframe.contentWindow.document;
          if (iframeDoc && iframeDoc.readyState === "complete") {
            const videoError = iframeDoc.querySelector("video[error]");
            if (videoError) {
              console.log("Video error detected, reloading iframe...");
              reloadIframe();
            }
          }
        }, 5000); // Check every 5 seconds
      });
    </script>
  </body>
</html>
