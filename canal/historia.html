<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reproductor de Video</title>
    <link href="https://vjs.zencdn.net/7.15.4/video-js.css" rel="stylesheet" />
    <script src="https://vjs.zencdn.net/7.15.4/video.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
      #my-video {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 9999;
      }
      .video-js .vjs-big-play-button {
        background-color: #0077ff;
      }
      .video-js {
        background-color: #000000;
      }
      .video-js .vjs-control-bar {
        background-color: #333;
      }
      .video-js .vjs-control-text {
        color: #fff;
      }
    </style>
  </head>
  <body>
    <video
      id="my-video"
      class="video-js vjs-default-skin"
      controls
      preload="metadata"
      autoplay
    >
      <p class="vjs-no-js">
        Para ver este video, activa JavaScript y considera actualizar a un
        navegador web que
        <a
          href="https://videojs.com/html5-video-support/"
          target="_blank"
          rel="noopener"
          >soporte video HTML5</a
        >.
      </p>
      <button
        id="cast-button"
        class="vjs-control vjs-button"
        title="Transmitir a dispositivo"
      >
        Cast
      </button>
    </video>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var videoElement = document.getElementById("my-video");
        var castButton = document.getElementById("cast-button");

        // Integrar HLS.js
        if (Hls.isSupported()) {
          var hls = new Hls();
          hls.loadSource("http://170.254.18.106/CINEMAX/index.m3u8");
          hls.attachMedia(videoElement);
          hls.on(Hls.Events.MANIFEST_PARSED, function () {
            videoElement.play();
          });
        } else if (videoElement.canPlayType("application/vnd.apple.mpegurl")) {
          videoElement.src = "http://170.254.18.106/CINEMAX/index.m3u8";
          videoElement.addEventListener("loadedmetadata", function () {
            videoElement.play();
          });
        }

        // Funcionalidad de Cast
        castButton.addEventListener("click", function () {
          castToReceiver();
        });

        function castToReceiver() {
          if (chrome.cast.isAvailable) {
            var sessionRequest = new chrome.cast.SessionRequest(
              chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID
            );
            var apiConfig = new chrome.cast.ApiConfig(
              sessionRequest,
              sessionListener,
              receiverListener
            );

            chrome.cast.initialize(apiConfig, onInitSuccess, onError);
          }
        }

        function sessionListener(session) {
          // Manejar la conexión con el dispositivo receptor
        }

        function receiverListener(availability) {
          if (availability === chrome.cast.ReceiverAvailability.AVAILABLE) {
            castButton.style.display = "block"; // Mostrar el botón de Cast si hay dispositivos disponibles
          } else {
            castButton.style.display = "none"; // Ocultar el botón de Cast si no hay dispositivos disponibles
          }
        }

        function onInitSuccess() {
          console.log("Cast API initialized");
        }

        function onError(error) {
          console.error("Error initializing Cast API:", error);
        }

        // Control de teclado para Android TV
        document.addEventListener("keydown", function (event) {
          var key = event.key;

          if (key === "ArrowUp" || key === "ArrowDown") {
            // Navegar por los botones del reproductor
            var focusedButton = document.activeElement;
            var buttons =
              videoElement.parentElement.querySelectorAll(".vjs-button");

            var index = Array.prototype.indexOf.call(buttons, focusedButton);
            var newIndex =
              key === "ArrowUp"
                ? Math.max(index - 1, 0)
                : Math.min(index + 1, buttons.length - 1);

            buttons[newIndex].focus();
          } else if (key === "ArrowLeft" || key === "ArrowRight") {
            // Controlar el volumen del reproductor
            var currentVolume = videoElement.volume;

            if (key === "ArrowLeft") {
              videoElement.volume = Math.max(currentVolume - 0.1, 0.0);
            } else if (key === "ArrowRight") {
              videoElement.volume = Math.min(currentVolume + 0.1, 1.0);
            }
          } else if (key === "Enter") {
            // Reproducir / Pausar el video
            if (videoElement.paused) {
              videoElement.play();
            } else {
              videoElement.pause();
            }
          } else if (key === "MediaPlayPause") {
            // Reproducir / Pausar el video (botón de reproducción / pausa del control remoto)
            if (videoElement.paused) {
              videoElement.play();
            } else {
              videoElement.pause();
            }
          } else if (key === "MediaStop") {
            // Detener el video (botón de stop del control remoto)
            videoElement.pause();
            videoElement.currentTime = 0;
          }
        });
      });
    </script>
  </body>
</html>
